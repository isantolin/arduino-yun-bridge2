# Auto-generated protocol specification source for Yun Bridge v2.
# Any modifications here should be reflected by re-running tools/protocol/generate.py.

[constants]
protocol_version = 0x02
default_baudrate = 115200
max_payload_size = 128
rpc_buffer_size = 128
max_filepath_length = 64
max_datastore_key_length = 32
default_ack_timeout_ms = 200
default_retry_limit = 5
max_pending_tx_frames = 2
invalid_id_sentinel = 0xFFFF
response_offset = 0x80
uint8_mask = 0xFF
uint16_max = 0xFFFF
process_default_exit_code = 0xFF
crc32_mask = 0xFFFFFFFF
frame_delimiter = 0x00
digital_low = 0x00
digital_high = 0x01

[handshake]
nonce_length = 16
tag_length = 16
tag_algorithm = "HMAC-SHA256"
tag_description = "HMAC-SHA256(secret, nonce) truncated to 16 bytes"
config_format = ">HBI"
config_description = "Serialized timing config: ack_timeout_ms (uint16), ack_retry_limit (uint8), response_timeout_ms (uint32)"
ack_timeout_min_ms = 25
ack_timeout_max_ms = 60000
response_timeout_min_ms = 100
response_timeout_max_ms = 180000
retry_limit_min = 1
retry_limit_max = 8

[data_formats]
datastore_key_len_format = ">B"
datastore_value_len_format = ">B"
crc_covered_header_format = ">BHH"
crc_format = ">I"
uint8_format = ">B"
uint16_format = ">H"
uint32_format = ">I"
pin_read_format = ">B"
pin_write_format = ">BB"

[mqtt_suffixes]
incoming_available = "incoming_available"
outgoing_available = "outgoing_available"
response = "response"

[[topics]]
name = "ANALOG"
value = "a"
description = "Analog pin operations"
[[topics]]
name = "CONSOLE"
value = "console"
description = "Remote console"
[[topics]]
name = "DATASTORE"
value = "datastore"
description = "Key-value storage"
[[topics]]
name = "DIGITAL"
value = "d"
description = "Digital pin operations"
[[topics]]
name = "FILE"
value = "file"
description = "File system operations"
[[topics]]
name = "MAILBOX"
value = "mailbox"
description = "Message passing"
[[topics]]
name = "SHELL"
value = "sh"
description = "Shell command execution"
[[topics]]
name = "STATUS"
value = "status"
description = "System status reporting"
[[topics]]
name = "SYSTEM"
value = "system"
description = "System control and info"

[[actions]]
name = "FILE_READ"
value = "read"
description = "Read file content"
[[actions]]
name = "FILE_WRITE"
value = "write"
description = "Write file content"
[[actions]]
name = "FILE_REMOVE"
value = "remove"
description = "Remove file"
[[actions]]
name = "SHELL_RUN"
value = "run"
description = "Run shell command"
[[actions]]
name = "SHELL_RUN_ASYNC"
value = "run_async"
description = "Run shell command asynchronously"
[[actions]]
name = "SHELL_POLL"
value = "poll"
description = "Poll shell command status"
[[actions]]
name = "SHELL_KILL"
value = "kill"
description = "Kill shell command"
[[actions]]
name = "MAILBOX_WRITE"
value = "write"
description = "Write to mailbox"
[[actions]]
name = "DATASTORE_GET"
value = "get"
description = "Get datastore value"
[[actions]]
name = "DATASTORE_PUT"
value = "put"
description = "Put datastore value"
[[actions]]
name = "PIN_MODE"
value = "mode"
description = "Set pin mode"
[[actions]]
name = "PIN_READ"
value = "read"
description = "Read pin value"
[[actions]]
name = "CONSOLE_IN"
value = "in"
description = "Console input"
[[actions]]
name = "MAILBOX_READ"
value = "read"
description = "Read from mailbox"
[[actions]]
name = "SYSTEM_FREE_MEMORY"
value = "free_memory"
description = "System free memory"
[[actions]]
name = "SYSTEM_VERSION"
value = "version"
description = "System version"
[[actions]]
name = "SYSTEM_GET"
value = "get"
description = "Get system info"

[[statuses]]
name = "OK"
value = 0x00
description = "Operation completed successfully."
[[statuses]]
name = "ERROR"
value = 0x01
description = "Generic failure."
[[statuses]]
name = "CMD_UNKNOWN"
value = 0x02
description = "Command not recognized."
[[statuses]]
name = "MALFORMED"
value = 0x03
description = "Payload had invalid structure."
[[statuses]]
name = "OVERFLOW"
value = 0x08
description = "Frame exceeded buffer size."
[[statuses]]
name = "CRC_MISMATCH"
value = 0x04
description = "CRC check failed."
[[statuses]]
name = "TIMEOUT"
value = 0x05
description = "Operation timed out."
[[statuses]]
name = "NOT_IMPLEMENTED"
value = 0x06
description = "Command defined but not supported."
[[statuses]]
name = "ACK"
value = 0x07
description = "Generic acknowledgement for fire-and-forget commands."

[[commands]]
name = "CMD_GET_VERSION"
value = 0x00
category = "system"
direction = "linux_to_mcu"
[[commands]]
name = "CMD_GET_VERSION_RESP"
value = 0x80
category = "system"
direction = "mcu_to_linux"
[[commands]]
name = "CMD_GET_FREE_MEMORY"
value = 0x01
category = "system"
direction = "linux_to_mcu"
[[commands]]
name = "CMD_GET_FREE_MEMORY_RESP"
value = 0x82
category = "system"
direction = "mcu_to_linux"
[[commands]]
name = "CMD_GET_TX_DEBUG_SNAPSHOT"
value = 0x04
category = "system"
direction = "linux_to_mcu"
[[commands]]
name = "CMD_GET_TX_DEBUG_SNAPSHOT_RESP"
value = 0x85
category = "system"
direction = "mcu_to_linux"
[[commands]]
name = "CMD_SET_BAUDRATE"
value = 0x05
category = "system"
direction = "linux_to_mcu"
[[commands]]
name = "CMD_SET_BAUDRATE_RESP"
value = 0x86
category = "system"
direction = "mcu_to_linux"
[[commands]]
name = "CMD_LINK_SYNC"
value = 0x02
category = "system"
direction = "linux_to_mcu"
[[commands]]
name = "CMD_LINK_SYNC_RESP"
value = 0x83
category = "system"
direction = "mcu_to_linux"
[[commands]]
name = "CMD_LINK_RESET"
value = 0x03
category = "system"
direction = "linux_to_mcu"
[[commands]]
name = "CMD_LINK_RESET_RESP"
value = 0x84
category = "system"
direction = "mcu_to_linux"
[[commands]]
name = "CMD_XOFF"
value = 0x08
category = "flow_control"
direction = "mcu_to_linux"
[[commands]]
name = "CMD_XON"
value = 0x09
category = "flow_control"
direction = "mcu_to_linux"
[[commands]]
name = "CMD_SET_PIN_MODE"
value = 0x10
category = "gpio"
direction = "linux_to_mcu"
requires_ack = true
[[commands]]
name = "CMD_DIGITAL_WRITE"
value = 0x11
category = "gpio"
direction = "linux_to_mcu"
requires_ack = true
[[commands]]
name = "CMD_ANALOG_WRITE"
value = 0x12
category = "gpio"
direction = "linux_to_mcu"
requires_ack = true
[[commands]]
name = "CMD_DIGITAL_READ"
value = 0x13
category = "gpio"
direction = "linux_to_mcu"
[[commands]]
name = "CMD_ANALOG_READ"
value = 0x14
category = "gpio"
direction = "linux_to_mcu"
[[commands]]
name = "CMD_DIGITAL_READ_RESP"
value = 0x15
category = "gpio"
direction = "mcu_to_linux"
[[commands]]
name = "CMD_ANALOG_READ_RESP"
value = 0x16
category = "gpio"
direction = "mcu_to_linux"
[[commands]]
name = "CMD_CONSOLE_WRITE"
value = 0x20
category = "console"
direction = "bidirectional"
requires_ack = true
[[commands]]
name = "CMD_DATASTORE_PUT"
value = 0x30
category = "datastore"
direction = "mcu_to_linux"
requires_ack = true
[[commands]]
name = "CMD_DATASTORE_GET"
value = 0x31
category = "datastore"
direction = "mcu_to_linux"
[[commands]]
name = "CMD_DATASTORE_GET_RESP"
value = 0x81
category = "datastore"
direction = "linux_to_mcu"
[[commands]]
name = "CMD_MAILBOX_READ"
value = 0x40
category = "mailbox"
direction = "mcu_to_linux"
[[commands]]
name = "CMD_MAILBOX_PROCESSED"
value = 0x41
category = "mailbox"
direction = "mcu_to_linux"
[[commands]]
name = "CMD_MAILBOX_AVAILABLE"
value = 0x42
category = "mailbox"
direction = "mcu_to_linux"
[[commands]]
name = "CMD_MAILBOX_PUSH"
value = 0x43
category = "mailbox"
direction = "bidirectional"
[[commands]]
name = "CMD_MAILBOX_READ_RESP"
value = 0x90
category = "mailbox"
direction = "linux_to_mcu"
[[commands]]
name = "CMD_MAILBOX_AVAILABLE_RESP"
value = 0x92
category = "mailbox"
direction = "linux_to_mcu"
[[commands]]
name = "CMD_FILE_WRITE"
value = 0x50
category = "filesystem"
direction = "bidirectional"
[[commands]]
name = "CMD_FILE_READ"
value = 0x51
category = "filesystem"
direction = "mcu_to_linux"
[[commands]]
name = "CMD_FILE_REMOVE"
value = 0x52
category = "filesystem"
direction = "mcu_to_linux"
[[commands]]
name = "CMD_FILE_READ_RESP"
value = 0xA1
category = "filesystem"
direction = "linux_to_mcu"
[[commands]]
name = "CMD_PROCESS_RUN"
value = 0x60
category = "process"
direction = "mcu_to_linux"
[[commands]]
name = "CMD_PROCESS_RUN_ASYNC"
value = 0x61
category = "process"
direction = "mcu_to_linux"
[[commands]]
name = "CMD_PROCESS_POLL"
value = 0x62
category = "process"
direction = "mcu_to_linux"
[[commands]]
name = "CMD_PROCESS_KILL"
value = 0x63
category = "process"
direction = "mcu_to_linux"
[[commands]]
name = "CMD_PROCESS_RUN_RESP"
value = 0xB0
category = "process"
direction = "linux_to_mcu"
[[commands]]
name = "CMD_PROCESS_RUN_ASYNC_RESP"
value = 0xB1
category = "process"
direction = "linux_to_mcu"
[[commands]]
name = "CMD_PROCESS_POLL_RESP"
value = 0xB2
category = "process"
direction = "linux_to_mcu"
