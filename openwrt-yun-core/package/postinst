#!/bin/sh
# postinst script for openwrt-yun-core
# Crea el entorno virtual Python en la SD si no existe y actualiza pip

SD_MOUNT="/mnt/sda1"
VENV_PATH="$SD_MOUNT/pyenv"
PYTHON="$VENV_PATH/bin/python3"
PIP="$VENV_PATH/bin/pip"

if [ ! -d "$VENV_PATH" ]; then
    echo "[openwrt-yun-core] Creando entorno virtual Python en $VENV_PATH"
    python3 -m venv "$VENV_PATH" || { echo "ERROR: No se pudo crear el entorno virtual en la SD"; exit 1; }
fi

if [ -x "$PYTHON" ]; then
    echo "[openwrt-yun-core] Activando entorno virtual y actualizando pip..."
    . "$VENV_PATH/bin/activate"
    $PIP install --upgrade pip
fi
