"""Shared constants for Yun Bridge daemon components."""
from __future__ import annotations

from ssl import TLSVersion

from .protocol.topics import Topic


SERIAL_TERMINATOR: bytes = b"\x00"
STATUS_FILE_PATH: str = "/tmp/yunbridge_status.json"
ALLOWED_COMMAND_WILDCARD: str = "*"
MQTT_TLS_MIN_VERSION: TLSVersion = TLSVersion.TLSv1_2

DEFAULT_SERIAL_PORT: str = "/dev/ttyATH0"
DEFAULT_SERIAL_BAUD: int = 115200
DEFAULT_MQTT_HOST: str = "127.0.0.1"
DEFAULT_MQTT_PORT: int = 8883
DEFAULT_MQTT_TOPIC: str = "br"
DEFAULT_MQTT_CAFILE: str = "/etc/ssl/certs/ca-certificates.crt"
DEFAULT_FILE_SYSTEM_ROOT: str = "/root/yun_files"
DEFAULT_PROCESS_TIMEOUT: int = 10
DEFAULT_MQTT_QUEUE_LIMIT: int = 256
DEFAULT_RECONNECT_DELAY: int = 5
DEFAULT_STATUS_INTERVAL: int = 5
DEFAULT_CONSOLE_QUEUE_LIMIT_BYTES: int = 16384
DEFAULT_MAILBOX_QUEUE_LIMIT: int = 64
DEFAULT_MAILBOX_QUEUE_BYTES_LIMIT: int = 65536
DEFAULT_PENDING_PIN_REQUESTS: int = 32
DEFAULT_SERIAL_RETRY_TIMEOUT: float = 0.75
DEFAULT_SERIAL_RESPONSE_TIMEOUT: float = 3.0
DEFAULT_SERIAL_RETRY_ATTEMPTS: int = 3
DEFAULT_SERIAL_HANDSHAKE_MIN_INTERVAL: float = 0.0
SERIAL_HANDSHAKE_BACKOFF_BASE: float = 1.0
SERIAL_HANDSHAKE_BACKOFF_MAX: float = 60.0
SERIAL_NONCE_LENGTH: int = 16
SERIAL_HANDSHAKE_TAG_LEN: int = 16
MIN_SERIAL_SHARED_SECRET_LEN: int = 8
DEFAULT_SERIAL_SHARED_SECRET: bytes = b"changeme123"
DEFAULT_MQTT_SPOOL_DIR: str = "/root/.yunbridge/mqtt_spool"
DEFAULT_PROCESS_MAX_OUTPUT_BYTES: int = 65536
DEFAULT_PROCESS_MAX_CONCURRENT: int = 4
DEFAULT_METRICS_HOST: str = "127.0.0.1"
DEFAULT_METRICS_PORT: int = 9130

TOPIC_ANALOG: str = Topic.ANALOG.value
TOPIC_CONSOLE: str = Topic.CONSOLE.value
TOPIC_DATASTORE: str = Topic.DATASTORE.value
TOPIC_DIGITAL: str = Topic.DIGITAL.value
TOPIC_FILE: str = Topic.FILE.value
TOPIC_MAILBOX: str = Topic.MAILBOX.value
TOPIC_MAILBOX_INCOMING_AVAILABLE: str = "mailbox/incoming_available"
TOPIC_MAILBOX_OUTGOING_AVAILABLE: str = "mailbox/outgoing_available"
TOPIC_SHELL: str = Topic.SHELL.value
TOPIC_STATUS: str = Topic.STATUS.value
TOPIC_SYSTEM: str = Topic.SYSTEM.value

WATCHDOG_TRIGGER_TOKEN: bytes = b"WATCHDOG=trigger\n"
DEFAULT_WATCHDOG_INTERVAL: float = 5.0

__all__ = [
    "SERIAL_TERMINATOR",
    "STATUS_FILE_PATH",
    "ALLOWED_COMMAND_WILDCARD",
    "MQTT_TLS_MIN_VERSION",
    "DEFAULT_SERIAL_PORT",
    "DEFAULT_SERIAL_BAUD",
    "DEFAULT_MQTT_HOST",
    "DEFAULT_MQTT_PORT",
    "DEFAULT_MQTT_TOPIC",
    "DEFAULT_MQTT_CAFILE",
    "DEFAULT_FILE_SYSTEM_ROOT",
    "DEFAULT_PROCESS_TIMEOUT",
    "DEFAULT_MQTT_QUEUE_LIMIT",
    "DEFAULT_RECONNECT_DELAY",
    "DEFAULT_STATUS_INTERVAL",
    "DEFAULT_CONSOLE_QUEUE_LIMIT_BYTES",
    "DEFAULT_MAILBOX_QUEUE_LIMIT",
    "DEFAULT_MAILBOX_QUEUE_BYTES_LIMIT",
    "DEFAULT_PENDING_PIN_REQUESTS",
    "DEFAULT_SERIAL_RETRY_TIMEOUT",
    "DEFAULT_SERIAL_RESPONSE_TIMEOUT",
    "DEFAULT_SERIAL_RETRY_ATTEMPTS",
    "DEFAULT_SERIAL_HANDSHAKE_MIN_INTERVAL",
    "SERIAL_HANDSHAKE_BACKOFF_BASE",
    "SERIAL_HANDSHAKE_BACKOFF_MAX",
    "SERIAL_NONCE_LENGTH",
    "SERIAL_HANDSHAKE_TAG_LEN",
    "MIN_SERIAL_SHARED_SECRET_LEN",
    "DEFAULT_SERIAL_SHARED_SECRET",
    "DEFAULT_MQTT_SPOOL_DIR",
    "DEFAULT_PROCESS_MAX_OUTPUT_BYTES",
    "DEFAULT_PROCESS_MAX_CONCURRENT",
    "DEFAULT_METRICS_HOST",
    "DEFAULT_METRICS_PORT",
    "TOPIC_ANALOG",
    "TOPIC_CONSOLE",
    "TOPIC_DATASTORE",
    "TOPIC_DIGITAL",
    "TOPIC_FILE",
    "TOPIC_MAILBOX",
    "TOPIC_MAILBOX_INCOMING_AVAILABLE",
    "TOPIC_MAILBOX_OUTGOING_AVAILABLE",
    "TOPIC_SHELL",
    "TOPIC_STATUS",
    "TOPIC_SYSTEM",
    "WATCHDOG_TRIGGER_TOKEN",
    "DEFAULT_WATCHDOG_INTERVAL",
]
